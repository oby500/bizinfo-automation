'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Search, Filter, Calendar, Building2 } from 'lucide-react';

interface Announcement {
  id: string;
  title: string;
  organization: string;
  source: string;
  start_date: string;
  end_date: string;
  status: string;
  category?: string;
  simple_summary?: string;
  detailed_summary?: string;
  created_at?: string;
  views?: number;
  relevance?: number; // AI ê²€ìƒ‰ ìœ ì‚¬ë„ ì ìˆ˜
}

interface SearchFilters {
  status: 'all' | 'ongoing' | 'deadline';
  category?: string;
  region?: string;
  target?: string;
  age?: string;
  businessYear?: string;
  sort?: 'newest' | 'deadline' | 'views' | 'relevance';
}

interface FilterOptions {
  categories: string[];
  regions: string[];
  targets: string[];
  ages: string[];
  business_years: string[];
}

export default function HomePage() {
  const router = useRouter();
  const [searchQuery, setSearchQuery] = useState('');
  const [announcements, setAnnouncements] = useState<Announcement[]>([]);
  const [loading, setLoading] = useState(false);
  const [filters, setFilters] = useState<SearchFilters>({
    status: 'all',
    sort: 'newest'
  });
  const [filterOptions, setFilterOptions] = useState<FilterOptions>({
    categories: [],
    regions: [],
    targets: [],
    ages: [],
    business_years: []
  });
  const [currentPage, setCurrentPage] = useState(1);
  const [totalResults, setTotalResults] = useState(0);
  const [useAISearch, setUseAISearch] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [suggestions, setSuggestions] = useState<string[]>([]);
  const [showSuggestions, setShowSuggestions] = useState(false);
  const [notificationPermission, setNotificationPermission] = useState<NotificationPermission>('default');
  const [compareList, setCompareList] = useState<Announcement[]>([]);
  const [showCompareModal, setShowCompareModal] = useState(false);
  const [recentViews, setRecentViews] = useState<any[]>([]);
  const [bookmarks, setBookmarks] = useState<string[]>([]);
  const [userBalance, setUserBalance] = useState(0);
  const [userName, setUserName] = useState<string>('ì‚¬ìš©ì');

  const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
  const PAGE_SIZE = 20;
  const MAX_COMPARE = 3;

  // ì¼ë°˜ ê²€ìƒ‰ í•¨ìˆ˜ (ì²« ê²€ìƒ‰)
  const handleSearch = async (resetPage = true) => {
    if (!searchQuery.trim()) return;

    setLoading(true);
    setError(null);

    const page = resetPage ? 1 : currentPage;

    try {
      const params = new URLSearchParams({
        q: searchQuery,
        page: page.toString(),
        limit: PAGE_SIZE.toString(),
      });

      if (filters.status !== 'all') {
        params.append('status', filters.status);
      }

      if (filters.sort) {
        params.append('sort', filters.sort);
      }

      const response = await fetch(`${API_URL}/api/search?${params}`);

      if (!response.ok) {
        throw new Error(`ê²€ìƒ‰ ì‹¤íŒ¨: ${response.statusText}`);
      }

      const data = await response.json();

      if (resetPage) {
        setAnnouncements(data.results || []);
        setCurrentPage(1);
      } else {
        setAnnouncements(prev => [...prev, ...(data.results || [])]);
      }

      setTotalResults(data.total || 0);
    } catch (error) {
      console.error('ê²€ìƒ‰ ì‹¤íŒ¨:', error);
      setError(error instanceof Error ? error.message : 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      if (resetPage) {
        setAnnouncements([]);
        setTotalResults(0);
      }
    } finally {
      setLoading(false);
    }
  };


  // AI ì˜ë¯¸ ê²€ìƒ‰ í•¨ìˆ˜ (ì²« ê²€ìƒ‰)
  const handleSemanticSearch = async (resetPage = true) => {
    if (!searchQuery.trim()) return;

    setLoading(true);
    setError(null);
    try {
      const params = new URLSearchParams({
        q: searchQuery,
        threshold: '0.5',
        limit: PAGE_SIZE.toString(),
      });

      if (filters.status !== 'all') {
        params.append('status', filters.status);
      }

      const response = await fetch(`${API_URL}/api/search/semantic?${params}`);

      if (!response.ok) {
        throw new Error('AI ê²€ìƒ‰ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¼ë°˜ ê²€ìƒ‰ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤.');
      }

      const data = await response.json();

      // ì˜ë¯¸ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì¼ë°˜ ê²€ìƒ‰ê³¼ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
      const semanticResults = (data.data || []).map((item: any) => ({
        ...item,
        relevance: item.similarity, // ìœ ì‚¬ë„ ì ìˆ˜ ì¶”ê°€
      }));

      if (resetPage) {
        setAnnouncements(semanticResults);
        setCurrentPage(1);
      } else {
        setAnnouncements(prev => [...prev, ...semanticResults]);
      }

      setTotalResults(data.total || 0);
    } catch (error) {
      console.error('AI ê²€ìƒ‰ ì‹¤íŒ¨:', error);
      setError(error instanceof Error ? error.message : 'AI ê²€ìƒ‰ ì‹¤íŒ¨. ì¼ë°˜ ê²€ìƒ‰ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤.');
      // ì‹¤íŒ¨ ì‹œ ì¼ë°˜ ê²€ìƒ‰ìœ¼ë¡œ í´ë°±
      await handleSearch(resetPage);
    } finally {
      setLoading(false);
    }
  };

  // í•„í„° ì˜µì…˜ ë¡œë“œ
  useEffect(() => {
    async function fetchFilterOptions() {
      try {
        const response = await fetch(`${API_URL}/api/filters`);
        const data = await response.json();
        if (data.success) {
          setFilterOptions(data.filters);
        }
      } catch (error) {
        console.error('í•„í„° ì˜µì…˜ ë¡œë”© ì‹¤íŒ¨:', error);
      }
    }
    fetchFilterOptions();
  }, []);

  // ìµœê·¼ ê³µê³  ë¶ˆëŸ¬ì˜¤ê¸° (ì´ˆê¸° ë¡œë”© - ë§ˆê°ëœ ê³µê³  ì œì™¸)
  useEffect(() => {
    async function fetchRecent() {
      try {
        const response = await fetch(`${API_URL}/api/recent?limit=20&status=ongoing`);
        const data = await response.json();
        setAnnouncements(data.results || []);
        setTotalResults(data.total || 0);
      } catch (error) {
        console.error('ìµœê·¼ ê³µê³  ë¡œë”© ì‹¤íŒ¨:', error);
      }
    }
    fetchRecent();
  }, []);

  // í˜ì´ì§€ ë³€ê²½ í•¸ë“¤ëŸ¬
  const handlePageChange = async (newPage: number) => {
    setCurrentPage(newPage);
    setLoading(true);

    window.scrollTo({ top: 0, behavior: 'smooth' });

    try {
      const params = new URLSearchParams({
        q: searchQuery || '',
        page: newPage.toString(),
        limit: PAGE_SIZE.toString(),
      });

      if (filters.status !== 'all') {
        params.append('status', filters.status);
      }

      if (filters.sort) {
        params.append('sort', filters.sort);
      }

      const endpoint = useAISearch ? '/api/search/semantic' : (searchQuery ? '/api/search' : '/api/recent');
      const response = await fetch(`${API_URL}${endpoint}?${params}`);

      if (!response.ok) {
        throw new Error('í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨');
      }

      const data = await response.json();
      const results = useAISearch
        ? (data.data || []).map((item: any) => ({ ...item, relevance: item.similarity }))
        : (data.results || []);

      setAnnouncements(results);
      setTotalResults(data.total || 0);
    } catch (error) {
      console.error('í˜ì´ì§€ ë¡œë”© ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  // ì•Œë¦¼ ê¶Œí•œ í™•ì¸ ë° ì •ê¸° ì²´í¬
  useEffect(() => {
    // ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ ìƒíƒœ í™•ì¸
    if ('Notification' in window) {
      setNotificationPermission(Notification.permission);

      // ê¶Œí•œì´ ìˆìœ¼ë©´ ì•Œë¦¼ ì²´í¬
      if (Notification.permission === 'granted') {
        checkAndSetupNotifications();

        // ë§¤ ì‹œê°„ë§ˆë‹¤ ì•Œë¦¼ ì²´í¬ (1ì‹œê°„ = 3600000ms)
        const interval = setInterval(checkAndSetupNotifications, 3600000);
        return () => clearInterval(interval);
      }
    }

    // ìµœê·¼ ë³¸ ê³µê³  ë¡œë“œ
    loadRecentViews();

    // ë¶ë§ˆí¬ ë¡œë“œ
    loadBookmarks();

    // ì‚¬ìš©ì ì”ì•¡ ë¡œë“œ
    loadUserBalance();

    // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
    loadUserInfo();
  }, []);

  // ê²€ìƒ‰ì–´ ì…ë ¥ ì²˜ë¦¬
  const handleSearchInput = async (value: string) => {
    setSearchQuery(value);

    if (value.trim().length >= 2) {
      try {
        const response = await fetch(`${API_URL}/api/suggestions?q=${encodeURIComponent(value)}`);
        const data = await response.json();

        if (data.success) {
          setSuggestions(data.suggestions || []);
          setShowSuggestions(true);
        }
      } catch (error) {
        console.error('ìë™ì™„ì„± ì¡°íšŒ ì‹¤íŒ¨:', error);
        setSuggestions([]);
      }
    } else {
      setSuggestions([]);
      setShowSuggestions(false);
    }
  };

  // ì œì•ˆ ì„ íƒ
  const handleSuggestionClick = (suggestion: string) => {
    setSearchQuery(suggestion);
    setShowSuggestions(false);
    setSuggestions([]);
  };

  // ì—”í„°í‚¤ë¡œ ê²€ìƒ‰
  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter') {
      setShowSuggestions(false);
      useAISearch ? handleSemanticSearch() : handleSearch();
    } else if (e.key === 'Escape') {
      setShowSuggestions(false);
    }
  };

  // D-Day ê³„ì‚° í•¨ìˆ˜
  const calculateDday = (endDate: string) => {
    const today = new Date();
    const end = new Date(endDate);
    const diffTime = end.getTime() - today.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    return diffDays;
  };

  // ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ ë°˜í™˜
  const getCategoryColor = (category?: string) => {
    if (!category) return 'bg-gray-100 text-gray-700';

    const lowerCategory = category.toLowerCase();

    if (lowerCategory.includes('ì°½ì—…')) return 'bg-blue-100 text-blue-700';
    if (lowerCategory.includes('ê¸°ìˆ ') || lowerCategory.includes('R&D')) return 'bg-purple-100 text-purple-700';
    if (lowerCategory.includes('ìˆ˜ì¶œ') || lowerCategory.includes('í•´ì™¸')) return 'bg-green-100 text-green-700';
    if (lowerCategory.includes('ê³ ìš©') || lowerCategory.includes('ì¸ë ¥')) return 'bg-orange-100 text-orange-700';
    if (lowerCategory.includes('ì‹œì„¤') || lowerCategory.includes('ì„¤ë¹„')) return 'bg-teal-100 text-teal-700';
    if (lowerCategory.includes('ìê¸ˆ') || lowerCategory.includes('ìœµì')) return 'bg-red-100 text-red-700';
    if (lowerCategory.includes('êµìœ¡') || lowerCategory.includes('ì»¨ì„¤íŒ…')) return 'bg-indigo-100 text-indigo-700';
    if (lowerCategory.includes('ë§ˆì¼€íŒ…') || lowerCategory.includes('íŒë¡œ')) return 'bg-pink-100 text-pink-700';

    return 'bg-gray-100 text-gray-700';
  };

  // ìµœê·¼ ë³¸ ê³µê³  ë¡œë“œ
  const loadRecentViews = () => {
    try {
      const recent = JSON.parse(localStorage.getItem('recentAnnouncements') || '[]');
      setRecentViews(recent);
    } catch (error) {
      console.error('ìµœê·¼ ë³¸ ê³µê³  ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ìµœê·¼ ë³¸ ê³µê³  ì €ì¥ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€)
  const saveRecentView = (announcement: Announcement) => {
    try {
      const recent = JSON.parse(localStorage.getItem('recentAnnouncements') || '[]');

      // ì¤‘ë³µ ì œê±° (ê°™ì€ IDê°€ ìˆìœ¼ë©´ ì œê±°)
      const filtered = recent.filter((item: any) => item.id !== announcement.id);

      // ë§¨ ì•ì— ì¶”ê°€
      const updated = [
        {
          id: announcement.id,
          title: announcement.title,
          organization: announcement.organization,
          end_date: announcement.end_date,
          viewedAt: new Date().toISOString()
        },
        ...filtered
      ].slice(0, 10); // ìµœëŒ€ 10ê°œë§Œ ì €ì¥

      localStorage.setItem('recentAnnouncements', JSON.stringify(updated));
      setRecentViews(updated); // ìƒíƒœ ì—…ë°ì´íŠ¸
    } catch (error) {
      console.error('ìµœê·¼ ë³¸ ê³µê³  ì €ì¥ ì‹¤íŒ¨:', error);
    }
  };

  // ê³µê³  í´ë¦­ í•¸ë“¤ëŸ¬
  const handleAnnouncementClick = (announcement: Announcement) => {
    saveRecentView(announcement);
    router.push(`/announcement/${announcement.id}`);
  };

  // ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
  const requestNotificationPermission = async () => {
    if (!('Notification' in window)) {
      alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      return;
    }

    const permission = await Notification.requestPermission();
    setNotificationPermission(permission);

    if (permission === 'granted') {
      // í…ŒìŠ¤íŠ¸ ì•Œë¦¼
      new Notification('ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤', {
        body: 'ë§ˆê° ì„ë°• ê³µê³ ì— ëŒ€í•œ ì•Œë¦¼ì„ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        icon: '/logo.png'
      });

      // ì•Œë¦¼ ì„¤ì • í™œì„±í™”
      checkAndSetupNotifications();
    }
  };

  // ë§ˆê° ì•Œë¦¼ ì„¤ì •
  const setupDeadlineNotification = (announcement: Announcement) => {
    try {
      const notifications = JSON.parse(localStorage.getItem('deadlineNotifications') || '[]');

      // ì´ë¯¸ ë“±ë¡ëœ ê³µê³ ì¸ì§€ í™•ì¸
      const exists = notifications.find((item: any) => item.id === announcement.id);
      if (exists) {
        alert('ì´ë¯¸ ì•Œë¦¼ì´ ì„¤ì •ëœ ê³µê³ ì…ë‹ˆë‹¤.');
        return;
      }

      // ì•Œë¦¼ ì¶”ê°€
      const updated = [
        ...notifications,
        {
          id: announcement.id,
          title: announcement.title,
          end_date: announcement.end_date,
          createdAt: new Date().toISOString()
        }
      ];

      localStorage.setItem('deadlineNotifications', JSON.stringify(updated));
      alert('ë§ˆê° ì•Œë¦¼ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤. (D-3, D-1ì— ì•Œë¦¼)');
    } catch (error) {
      console.error('ì•Œë¦¼ ì„¤ì • ì‹¤íŒ¨:', error);
    }
  };

  // ì•Œë¦¼ ì²´í¬ ë° ë°œì†¡
  const checkAndSetupNotifications = () => {
    if (notificationPermission !== 'granted') return;

    try {
      const notifications = JSON.parse(localStorage.getItem('deadlineNotifications') || '[]');
      const today = new Date();

      notifications.forEach((item: any) => {
        const endDate = new Date(item.end_date);
        const diffTime = endDate.getTime() - today.getTime();
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        // D-3 ë˜ëŠ” D-1 ì•Œë¦¼
        if (diffDays === 3 || diffDays === 1) {
          new Notification(`ë§ˆê° ${diffDays}ì¼ ì „!`, {
            body: item.title,
            icon: '/logo.png',
            tag: `deadline-${item.id}-${diffDays}`
          });
        }

        // ë§ˆê°ì¼ ì§€ë‚œ ì•Œë¦¼ ì‚­ì œ
        if (diffDays < 0) {
          const filtered = notifications.filter((n: any) => n.id !== item.id);
          localStorage.setItem('deadlineNotifications', JSON.stringify(filtered));
        }
      });
    } catch (error) {
      console.error('ì•Œë¦¼ ì²´í¬ ì‹¤íŒ¨:', error);
    }
  };

  // ë¹„êµ ëª©ë¡ì— ì¶”ê°€/ì œê±°
  const toggleCompare = (announcement: Announcement) => {
    const exists = compareList.find(item => item.id === announcement.id);

    if (exists) {
      // ì´ë¯¸ ìˆìœ¼ë©´ ì œê±°
      setCompareList(compareList.filter(item => item.id !== announcement.id));
    } else {
      // ì—†ìœ¼ë©´ ì¶”ê°€ (ìµœëŒ€ 3ê°œ)
      if (compareList.length >= MAX_COMPARE) {
        alert(`ìµœëŒ€ ${MAX_COMPARE}ê°œê¹Œì§€ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
        return;
      }
      setCompareList([...compareList, announcement]);
    }
  };

  // ë¹„êµ ëª©ë¡ ì´ˆê¸°í™”
  const clearCompare = () => {
    setCompareList([]);
    setShowCompareModal(false);
  };

  // ë¶ë§ˆí¬ ë¡œë“œ
  const loadBookmarks = () => {
    try {
      const saved = JSON.parse(localStorage.getItem('bookmarkedAnnouncements') || '[]');
      setBookmarks(saved);
    } catch (error) {
      console.error('ë¶ë§ˆí¬ ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ë¶ë§ˆí¬ í† ê¸€
  const toggleBookmark = (announcementId: string) => {
    try {
      const saved = JSON.parse(localStorage.getItem('bookmarkedAnnouncements') || '[]');

      let updated: string[];
      if (saved.includes(announcementId)) {
        // ì´ë¯¸ ë¶ë§ˆí¬ë˜ì–´ ìˆìœ¼ë©´ ì œê±°
        updated = saved.filter((id: string) => id !== announcementId);
      } else {
        // ì—†ìœ¼ë©´ ì¶”ê°€
        updated = [...saved, announcementId];
      }

      localStorage.setItem('bookmarkedAnnouncements', JSON.stringify(updated));
      setBookmarks(updated);
    } catch (error) {
      console.error('ë¶ë§ˆí¬ í† ê¸€ ì‹¤íŒ¨:', error);
    }
  };

  // ë¶ë§ˆí¬ ì—¬ë¶€ í™•ì¸
  const isBookmarked = (announcementId: string) => {
    return bookmarks.includes(announcementId);
  };

  // ì‚¬ìš©ì ì”ì•¡ ë¡œë“œ
  const loadUserBalance = () => {
    try {
      const balance = localStorage.getItem('userBalance');
      setUserBalance(balance ? parseInt(balance) : 0);
    } catch (error) {
      console.error('ì”ì•¡ ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
  const loadUserInfo = async () => {
    try {
      const response = await fetch('/api/user');
      const data = await response.json();

      if (data.user && data.user.user_metadata) {
        const fullName = data.user.user_metadata.full_name || data.user.user_metadata.name;

        if (fullName) {
          // ì´ë¦„ ë§ˆìŠ¤í‚¹ (ì˜ˆ: "í™ê¸¸ë™" â†’ "í™OO")
          const maskedName = fullName.charAt(0) + 'OO';
          setUserName(maskedName);
        } else {
          setUserName('ì‚¬ìš©ì');
        }
      }
    } catch (error) {
      console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
      setUserName('ì‚¬ìš©ì');
    }
  };

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Compact Header */}
      <header className="bg-gradient-to-r from-orange-500 to-red-500 text-white">
        <div className="container mx-auto px-6 py-3">
          <div className="flex items-center justify-between">
            {/* Left: Logo and Title */}
            <div>
              <h1 className="text-2xl font-bold mb-0.5">ë¡œíŠ¼</h1>
              <p className="text-sm text-white/90">ì •ë¶€ì§€ì› ë„ì „ - ì‹ ì²­ì„œë‚˜ ì‚¬ì—…ê³„íšì„œ ì´ˆì•ˆì„ AIê°€ ë„ì™€ë“œë¦½ë‹ˆë‹¤</p>
            </div>

            {/* Right: User controls */}
            <div className="flex items-center gap-2">
              {/* í¬ë ˆë”§ í‘œì‹œ */}
              <div className="flex items-center gap-2 px-3 py-1.5 bg-white/20 backdrop-blur-sm rounded-lg">
                <span className="text-xs text-white/90">ë³´ìœ  í¬ë ˆë”§</span>
                <span className="text-sm font-bold text-white">{userBalance.toLocaleString()}ì›</span>
              </div>

              {/* ì¶©ì „í•˜ê¸° */}
              <Button
                onClick={() => router.push('/charge')}
                size="sm"
                className="bg-green-500 text-white hover:bg-green-600 h-8"
              >
                ğŸ’³ ì¶©ì „í•˜ê¸°
              </Button>

              {/* ì‚¬ìš©ì ì •ë³´ */}
              <Button
                onClick={() => router.push('/mypage')}
                size="sm"
                variant="outline"
                className="border-white/40 text-white hover:bg-white/20 h-8"
              >
                ğŸ‘¤ {userName}ë‹˜
              </Button>
            </div>
          </div>
        </div>
      </header>

      {/* Main Layout: Sidebar + Content */}
      <div className="container mx-auto px-6 py-6 flex gap-6">
        {/* Left Sidebar - Filters */}
        <aside className="w-64 flex-shrink-0">
          <Card className="sticky top-6">
            <CardHeader>
              <CardTitle className="text-lg">ì¡°ê±´ê²€ìƒ‰</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              {/* AI ê²€ìƒ‰ í† ê¸€ */}
              <div className="flex items-center gap-3 p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg border border-purple-200">
                <input
                  type="checkbox"
                  id="ai-search"
                  checked={useAISearch}
                  onChange={(e) => setUseAISearch(e.target.checked)}
                  className="w-4 h-4 accent-purple-600 flex-shrink-0"
                />
                <label htmlFor="ai-search" className="text-sm font-medium text-purple-900 cursor-pointer flex items-center gap-1.5">
                  <span>âœ¨</span>
                  <span>AI ê²€ìƒ‰</span>
                </label>
              </div>

              {/* ë§ì¶¤ ê³µê³  ì•Œë¦¼ ì„¤ì • ë²„íŠ¼ */}
              <Button
                onClick={() => {
                  const keywords = prompt(
                    'ê´€ì‹¬ìˆëŠ” í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ì‰¼í‘œë¡œ êµ¬ë¶„)\n\n' +
                    'ì˜ˆì‹œ: ì²­ë…„ì°½ì—…, ì¤‘ì†Œê¸°ì—…, ê¸°ìˆ ê°œë°œ\n\n' +
                    'ì…ë ¥í•˜ì‹  í‚¤ì›Œë“œì™€ ê´€ë ¨ëœ ìƒˆ ê³µê³ ê°€ ë“±ë¡ë˜ë©´\n' +
                    'ì´ë©”ì¼ë¡œ ì•Œë¦¼ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.'
                  );

                  if (keywords && keywords.trim()) {
                    const email = localStorage.getItem('userEmail') || prompt('ì•Œë¦¼ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');

                    if (email && email.includes('@')) {
                      const keywordList = keywords.split(',').map(k => k.trim()).filter(k => k);

                      // localStorageì— ì €ì¥
                      localStorage.setItem('userEmail', email);
                      localStorage.setItem('customAlertKeywords', JSON.stringify(keywordList));

                      alert(
                        `âœ… ë§ì¶¤ ê³µê³  ì•Œë¦¼ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n` +
                        `í‚¤ì›Œë“œ: ${keywordList.join(', ')}\n` +
                        `ì•Œë¦¼: ${email}\n\n` +
                        `ìƒˆë¡œìš´ ê³µê³ ê°€ ë“±ë¡ë˜ë©´ ì¦‰ì‹œ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.`
                      );
                    } else if (email) {
                      alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    }
                  }
                }}
                variant="outline"
                className="w-full border-2 border-dashed border-orange-300 hover:bg-orange-50"
              >
                ğŸ”” ì•Œë¦¼ ì„¤ì •
              </Button>

              {/* ê²€ìƒ‰ì–´ ì…ë ¥ */}
              <div>
                <label className="text-sm font-medium text-gray-700 mb-2 block">
                  í‚¤ì›Œë“œ
                </label>
                <div className="relative">
                  <Search className="absolute left-3 top-3 h-4 w-4 text-gray-400 z-10" />
                  <Input
                    type="text"
                    placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ (2ê¸€ì ì´ìƒ)"
                    value={searchQuery}
                    onChange={(e) => handleSearchInput(e.target.value)}
                    onKeyDown={handleKeyPress}
                    onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}
                    onFocus={() => {
                      if (suggestions.length > 0) {
                        setShowSuggestions(true);
                      }
                    }}
                    className="pl-10"
                  />

                  {/* ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ */}
                  {showSuggestions && suggestions.length > 0 && (
                    <div className="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                      {suggestions.map((suggestion, index) => (
                        <div
                          key={index}
                          onClick={() => handleSuggestionClick(suggestion)}
                          className="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm"
                        >
                          {suggestion}
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>

              {/* ì§€ì›ë¶„ì•¼ */}
              <div>
                <label className="text-sm font-medium text-gray-700 mb-2 block">
                  ì§€ì›ë¶„ì•¼
                </label>
                <select
                  className="w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                  value={filters.category || ''}
                  onChange={(e) => setFilters({ ...filters, category: e.target.value || undefined })}
                >
                  <option value="">ì „ì²´</option>
                  {filterOptions.categories.map((cat) => (
                    <option key={cat} value={cat}>{cat}</option>
                  ))}
                </select>
              </div>

              {/* ì§€ì—­ */}
              <div>
                <label className="text-sm font-medium text-gray-700 mb-2 block">
                  ì§€ì—­
                </label>
                <select
                  className="w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                  value={filters.region || ''}
                  onChange={(e) => setFilters({ ...filters, region: e.target.value || undefined })}
                >
                  <option value="">ì „ì²´</option>
                  {filterOptions.regions.map((region) => (
                    <option key={region} value={region}>{region}</option>
                  ))}
                </select>
              </div>

              {/* ëŒ€ìƒ */}
              <div>
                <label className="text-sm font-medium text-gray-700 mb-2 block">
                  ëŒ€ìƒ
                </label>
                <select
                  className="w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                  value={filters.target || ''}
                  onChange={(e) => setFilters({ ...filters, target: e.target.value || undefined })}
                >
                  <option value="">ì „ì²´</option>
                  {filterOptions.targets.map((target) => (
                    <option key={target} value={target}>{target}</option>
                  ))}
                </select>
              </div>

              {/* ì—°ë ¹ */}
              <div>
                <label className="text-sm font-medium text-gray-700 mb-2 block">
                  ì—°ë ¹
                </label>
                <select
                  className="w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                  value={filters.age || ''}
                  onChange={(e) => setFilters({ ...filters, age: e.target.value || undefined })}
                >
                  <option value="">ì „ì²´</option>
                  {filterOptions.ages.map((age) => (
                    <option key={age} value={age}>{age}</option>
                  ))}
                </select>
              </div>

              {/* ì°½ì—…ì—…ë ¥ */}
              <div>
                <label className="text-sm font-medium text-gray-700 mb-2 block">
                  ì°½ì—…ì—…ë ¥
                </label>
                <select
                  className="w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                  value={filters.businessYear || ''}
                  onChange={(e) => setFilters({ ...filters, businessYear: e.target.value || undefined })}
                >
                  <option value="">ì „ì²´</option>
                  {filterOptions.business_years.map((year) => (
                    <option key={year} value={year}>{year}</option>
                  ))}
                </select>
              </div>

              {/* ìƒíƒœ */}
              <div>
                <label className="text-sm font-medium text-gray-700 mb-2 block">
                  ìƒíƒœ
                </label>
                <div className="space-y-2">
                  <Button
                    variant={filters.status === 'all' ? 'default' : 'outline'}
                    onClick={() => setFilters({ ...filters, status: 'all' })}
                    className="w-full justify-start text-sm"
                  >
                    ì „ì²´
                  </Button>
                  <Button
                    variant={filters.status === 'ongoing' ? 'default' : 'outline'}
                    onClick={() => setFilters({ ...filters, status: 'ongoing' })}
                    className="w-full justify-start text-sm"
                  >
                    ì§„í–‰ì¤‘
                  </Button>
                  <Button
                    variant={filters.status === 'deadline' ? 'default' : 'outline'}
                    onClick={() => setFilters({ ...filters, status: 'deadline' })}
                    className="w-full justify-start text-sm"
                  >
                    ë§ˆê°ì„ë°•
                  </Button>
                </div>
              </div>

              {/* ê²€ìƒ‰ ë²„íŠ¼ */}
              <Button
                onClick={useAISearch ? handleSemanticSearch : handleSearch}
                disabled={loading}
                className="w-full"
              >
                {loading ? 'ê²€ìƒ‰ ì¤‘...' : useAISearch ? 'âœ¨ AI ê²€ìƒ‰' : 'ğŸ” ê²€ìƒ‰'}
              </Button>
            </CardContent>
          </Card>

        </aside>

        {/* Center Content - Results */}
        <main className="flex-1">
          {/* ê²°ê³¼ í—¤ë” + ì •ë ¬ */}
          <div className="mb-4 flex items-center justify-between">
            <div>
              {searchQuery ? (
                <p className="text-gray-600">
                  <span className="font-semibold text-gray-900">&quot;{searchQuery}&quot;</span> ê²€ìƒ‰ ê²°ê³¼:{' '}
                  <span className="font-semibold text-orange-500">{totalResults.toLocaleString()}</span>ê±´
                </p>
              ) : (
                <p className="font-semibold text-gray-900 text-lg">ìµœê·¼ ê³µê³ </p>
              )}
            </div>

            {/* ì •ë ¬ ì˜µì…˜ */}
            <div className="flex items-center gap-2">
              <label className="text-sm text-gray-600">ì •ë ¬:</label>
              <select
                className="border border-gray-300 rounded-md px-3 py-1.5 text-sm"
                value={filters.sort || 'newest'}
                onChange={(e) => setFilters({ ...filters, sort: e.target.value as any })}
              >
                <option value="newest">ìµœì‹ ìˆœ</option>
                <option value="deadline">ë§ˆê°ì„ë°•ìˆœ</option>
                {useAISearch && <option value="relevance">ê´€ë ¨ë„ìˆœ</option>}
              </select>
            </div>
          </div>

          {/* ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ */}
          {error && (
            <div className="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
              <div className="flex items-start gap-2">
                <span className="text-red-600 text-lg">âš ï¸</span>
                <div className="flex-1">
                  <p className="text-sm font-medium text-red-800 mb-1">ê²€ìƒ‰ ì˜¤ë¥˜</p>
                  <p className="text-sm text-red-700">{error}</p>
                </div>
                <button
                  onClick={() => setError(null)}
                  className="text-red-600 hover:text-red-800 text-lg leading-none"
                  aria-label="ë‹«ê¸°"
                >
                  âœ•
                </button>
              </div>
            </div>
          )}


          {/* ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ */}
          <div className="space-y-3">
            {announcements.map((announcement) => (
              <Card
                key={announcement.id}
                className="hover:shadow-md transition-shadow"
              >
                  <CardContent className="p-4">
                    {/* ìƒë‹¨ ë©”íƒ€ì •ë³´: ì¹´í…Œê³ ë¦¬ | ì§€ì—­ | ê¸ˆì•¡ ì •ë³´ */}
                    <div className="flex items-center justify-between mb-3">
                      <div className="flex items-center gap-2">
                        {/* ì¹´í…Œê³ ë¦¬ ë°°ì§€ (ìƒ‰ìƒë³„) */}
                        {announcement.category && (
                          <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getCategoryColor(announcement.category)}`}>
                            {announcement.category}
                          </span>
                        )}

                        {/* ì§€ì—­ | ê¸ˆì•¡ ì •ë³´ */}
                        <div className="flex items-center gap-1.5 text-sm text-gray-500">
                          <span>{announcement.organization?.split(' ')[0] || 'ì „êµ­'}</span>
                          <span>|</span>
                          <span>ê¸ˆì•¡ ë¯¸ì •</span>
                        </div>
                      </div>

                      {/* ìš°ì¸¡ ìƒíƒœ ë°°ì§€ */}
                      <div className="flex gap-2">
                        {announcement.relevance && (
                          <Badge variant="outline" className="border-purple-500 text-purple-700 text-xs">
                            ğŸ¤– {Math.round(announcement.relevance * 100)}%
                          </Badge>
                        )}
                        {announcement.status === 'deadline' && (
                          <Badge variant="destructive" className="bg-red-500">N</Badge>
                        )}
                        {announcement.status === 'ongoing' && (
                          <Badge variant="outline" className="border-blue-500 text-blue-700">
                            D-{calculateDday(announcement.end_date)}
                          </Badge>
                        )}
                      </div>
                    </div>

                    {/* ì œëª© */}
                    <h3
                      className="text-lg font-bold text-gray-900 mb-2 hover:text-orange-500 cursor-pointer line-clamp-2"
                      onClick={() => handleAnnouncementClick(announcement)}
                    >
                      {announcement.title}
                    </h3>

                    {/* ê°„ë‹¨ìš”ì•½ - ë” ì˜ˆì˜ê²Œ í‘œì‹œ */}
                    {announcement.simple_summary && (
                      <div className="mb-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <p className="text-sm text-gray-700 line-clamp-2 leading-relaxed">
                          {announcement.simple_summary}
                        </p>
                      </div>
                    )}

                    {/* ìƒì„¸í˜ì´ì§€ URL ë§í¬ */}
                    <div className="mb-2">
                      <a
                        href={`/announcement/${announcement.id}`}
                        onClick={(e) => {
                          e.preventDefault();
                          handleAnnouncementClick(announcement);
                        }}
                        className="text-xs text-orange-500 hover:text-orange-600 hover:underline flex items-center gap-1"
                      >
                        <span>ğŸ”—</span>
                        <span>/announcement/{announcement.id}</span>
                      </a>
                    </div>

                    {/* í•˜ë‹¨ ë©”íƒ€ì •ë³´ */}
                    <div className="pt-3 border-t flex items-center justify-between">
                      <div className="text-xs text-gray-500">
                        {announcement.organization?.split(' ')[0] || announcement.organization} â€¢ ë§ˆê° {announcement.end_date}
                      </div>

                      {/* ì•¡ì…˜ ë²„íŠ¼ ê·¸ë£¹ */}
                      <div className="flex gap-1">
                        {/* ë¶ë§ˆí¬ ë²„íŠ¼ */}
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={(e) => {
                            e.stopPropagation();
                            toggleBookmark(announcement.id);
                          }}
                          className="h-8 px-3 text-xs hover:bg-orange-50"
                        >
                          {isBookmarked(announcement.id) ? 'â­' : 'â˜†'}
                        </Button>

                        {/* ë¹„êµ ì¶”ê°€ ë²„íŠ¼ */}
                        <Button
                          variant={compareList.find(item => item.id === announcement.id) ? "default" : "ghost"}
                          size="sm"
                          onClick={(e) => {
                            e.stopPropagation();
                            toggleCompare(announcement);
                          }}
                          className="h-8 px-3 text-xs"
                        >
                          {compareList.find(item => item.id === announcement.id) ? 'âœ“' : '+'}
                        </Button>

                        {/* ìƒì„¸ë³´ê¸° ë²„íŠ¼ */}
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={(e) => {
                            e.stopPropagation();
                            handleAnnouncementClick(announcement);
                          }}
                          className="h-8 px-3 text-xs border-orange-300 text-orange-600 hover:bg-orange-50"
                        >
                          ìƒì„¸ë³´ê¸°
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>
            ))}
          </div>

          {/* ë¡œë”© ìƒíƒœ - Skeleton UI */}
          {loading && (
            <div className="space-y-3">
              {[...Array(5)].map((_, i) => (
                <Card key={i} className="animate-pulse">
                  <CardContent className="p-4">
                    {/* ìƒë‹¨ ë°°ì§€ ìŠ¤ì¼ˆë ˆí†¤ */}
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex gap-2">
                        <div className="h-6 w-20 bg-gray-200 rounded-full"></div>
                      </div>
                      <div className="h-6 w-12 bg-gray-200 rounded-full"></div>
                    </div>

                    {/* ì œëª© ìŠ¤ì¼ˆë ˆí†¤ */}
                    <div className="h-6 bg-gray-200 rounded w-3/4 mb-3"></div>

                    {/* ìš”ì•½ ìŠ¤ì¼ˆë ˆí†¤ */}
                    <div className="space-y-2 mb-3">
                      <div className="h-4 bg-gray-200 rounded w-full"></div>
                      <div className="h-4 bg-gray-200 rounded w-5/6"></div>
                    </div>

                    {/* ë©”íƒ€ì •ë³´ ìŠ¤ì¼ˆë ˆí†¤ */}
                    <div className="pt-3 border-t">
                      <div className="h-4 bg-gray-200 rounded w-2/3"></div>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          )}

          {/* í˜ì´ì§€ë„¤ì´ì…˜ */}
          {!loading && announcements.length > 0 && totalResults > PAGE_SIZE && (
            <div className="mt-6 flex items-center justify-center gap-2">
              {/* ì´ì „ í˜ì´ì§€ */}
              <Button
                variant="outline"
                size="sm"
                onClick={() => handlePageChange(currentPage - 1)}
                disabled={currentPage === 1}
                className="px-3"
              >
                â† ì´ì „
              </Button>

              {/* í˜ì´ì§€ ë²ˆí˜¸ */}
              <div className="flex items-center gap-1">
                {Array.from({ length: Math.min(5, Math.ceil(totalResults / PAGE_SIZE)) }, (_, i) => {
                  const totalPages = Math.ceil(totalResults / PAGE_SIZE);
                  let pageNum;

                  if (totalPages <= 5) {
                    pageNum = i + 1;
                  } else if (currentPage <= 3) {
                    pageNum = i + 1;
                  } else if (currentPage >= totalPages - 2) {
                    pageNum = totalPages - 4 + i;
                  } else {
                    pageNum = currentPage - 2 + i;
                  }

                  return (
                    <Button
                      key={pageNum}
                      variant={currentPage === pageNum ? "default" : "outline"}
                      size="sm"
                      onClick={() => handlePageChange(pageNum)}
                      className="w-10"
                    >
                      {pageNum}
                    </Button>
                  );
                })}
              </div>

              {/* ë‹¤ìŒ í˜ì´ì§€ */}
              <Button
                variant="outline"
                size="sm"
                onClick={() => handlePageChange(currentPage + 1)}
                disabled={currentPage >= Math.ceil(totalResults / PAGE_SIZE)}
                className="px-3"
              >
                ë‹¤ìŒ â†’
              </Button>

              {/* í˜ì´ì§€ ì •ë³´ */}
              <span className="text-sm text-gray-500 ml-4">
                {currentPage} / {Math.ceil(totalResults / PAGE_SIZE)} í˜ì´ì§€
              </span>
            </div>
          )}

          {/* ê²°ê³¼ ì—†ìŒ */}
          {!loading && announcements.length === 0 && (
            <div className="text-center py-12">
              <p className="text-gray-500">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
          )}
        </main>

        {/* Right Sidebar - Recent Views */}
        {recentViews.length > 0 && (
          <aside className="w-64 flex-shrink-0">
            <Card className="sticky top-6">
              <CardHeader>
                <CardTitle className="text-lg">ìµœê·¼ ë³¸ ê³µê³ </CardTitle>
                <CardDescription className="text-xs">ìµœëŒ€ 10ê°œê¹Œì§€ ì €ì¥ë©ë‹ˆë‹¤</CardDescription>
              </CardHeader>
              <CardContent className="space-y-2">
                {recentViews.slice(0, 5).map((item) => (
                  <div
                    key={item.id}
                    className="p-2 hover:bg-gray-50 rounded cursor-pointer border border-gray-200"
                    onClick={() => router.push(`/announcement/${item.id}`)}
                  >
                    <p className="text-sm font-medium text-gray-900 line-clamp-2 mb-1">
                      {item.title}
                    </p>
                    <div className="flex items-center justify-between text-xs text-gray-500">
                      <span>{item.organization}</span>
                      <span className="text-orange-500">
                        D-{calculateDday(item.end_date)}
                      </span>
                    </div>
                  </div>
                ))}
                {recentViews.length > 5 && (
                  <button
                    className="text-xs text-gray-500 hover:text-gray-700 w-full text-center pt-2"
                    onClick={() => {
                      alert(`ì´ ${recentViews.length}ê°œì˜ ìµœê·¼ ë³¸ ê³µê³ ê°€ ìˆìŠµë‹ˆë‹¤.`);
                    }}
                  >
                    + {recentViews.length - 5}ê°œ ë”ë³´ê¸°
                  </button>
                )}
              </CardContent>
            </Card>
          </aside>
        )}
      </div>

      {/* ë¹„êµ ëª¨ë‹¬ */}
      {showCompareModal && compareList.length > 0 && (
        <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-6">
          <div className="bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b sticky top-0 bg-white">
              <div className="flex items-center justify-between">
                <h2 className="text-2xl font-bold text-gray-900">ê³µê³  ë¹„êµ</h2>
                <div className="flex gap-2">
                  <Button onClick={clearCompare} variant="outline">
                    ì´ˆê¸°í™”
                  </Button>
                  <Button onClick={() => setShowCompareModal(false)} variant="ghost">
                    âœ•
                  </Button>
                </div>
              </div>
            </div>

            <div className="p-6">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {compareList.map((announcement, index) => (
                  <Card key={announcement.id} className="border-2 border-orange-300">
                    <CardHeader>
                      <div className="flex items-start justify-between mb-2">
                        <Badge variant="default">ê³µê³  {index + 1}</Badge>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => toggleCompare(announcement)}
                        >
                          âœ•
                        </Button>
                      </div>
                      <CardTitle className="text-lg">{announcement.title}</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-3">
                      <div>
                        <p className="text-sm font-medium text-gray-700 mb-1">ê¸°ê´€</p>
                        <p className="text-sm text-gray-600">{announcement.organization}</p>
                      </div>
                      <div>
                        <p className="text-sm font-medium text-gray-700 mb-1">ì ‘ìˆ˜ê¸°ê°„</p>
                        <p className="text-sm text-gray-600">
                          {announcement.start_date} ~ {announcement.end_date}
                        </p>
                      </div>
                      <div>
                        <p className="text-sm font-medium text-gray-700 mb-1">D-Day</p>
                        <Badge variant={announcement.status === 'deadline' ? 'destructive' : 'outline'}>
                          {announcement.status === 'deadline' ? 'N' : `D-${calculateDday(announcement.end_date)}`}
                        </Badge>
                      </div>
                      {announcement.simple_summary && (
                        <div>
                          <p className="text-sm font-medium text-gray-700 mb-1">ìš”ì•½</p>
                          <p className="text-sm text-gray-600 line-clamp-3">
                            {announcement.simple_summary}
                          </p>
                        </div>
                      )}
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={() => handleAnnouncementClick(announcement)}
                        className="w-full mt-2"
                      >
                        ìƒì„¸ë³´ê¸°
                      </Button>
                    </CardContent>
                  </Card>
                ))}
              </div>

              {compareList.length < MAX_COMPARE && (
                <div className="mt-4 p-4 bg-gray-100 rounded-lg text-center">
                  <p className="text-sm text-gray-600">
                    ìµœëŒ€ {MAX_COMPARE}ê°œê¹Œì§€ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (í˜„ì¬ {compareList.length}ê°œ)
                  </p>
                </div>
              )}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
