name: Bizinfo Manual Run

on:
  workflow_dispatch:
    inputs:
      debug_mode:
        description: 'ë””ë²„ê·¸ ëª¨ë“œ ì‹¤í–‰'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'

jobs:
  manual-bizinfo:
    name: ê¸°ì—…ë§ˆë‹¹ ìˆ˜ë™ ì²˜ë¦¬
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
    
    - name: Install dependencies
      run: |
        pip install selenium webdriver-manager pandas openpyxl
        pip install requests beautifulsoup4 supabase
    
    - name: Run Bizinfo Collector
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
      run: |
        echo "=== ê¸°ì—…ë§ˆë‹¹ ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘ ==="
        echo "ì‹¤í–‰ ì‹œê°„: $(date '+%Y-%m-%d %H:%M:%S')"
        python scripts/bizinfo_excel_collector.py
    
    - name: Run Bizinfo Processor
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
      run: |
        echo "=== ì²¨ë¶€íŒŒì¼ ì²˜ë¦¬ ë° í•´ì‹œíƒœê·¸ ìƒì„± ==="
        python scripts/bizinfo_complete_processor.py
    
    - name: Show Results
      if: always()
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
      run: |
        echo "=== ì²˜ë¦¬ ê²°ê³¼ í™•ì¸ ==="
        python -c "
from supabase import create_client
import os
from datetime import datetime

url = os.environ.get('SUPABASE_URL')
key = os.environ.get('SUPABASE_KEY')
supabase = create_client(url, key)

today = datetime.now().date().isoformat()
today_data = supabase.table('bizinfo_complete').select('id').gte('created_at', today).execute()

print(f'ğŸ“Š ì˜¤ëŠ˜ ì²˜ë¦¬ ê²°ê³¼: {len(today_data.data)}ê°œ')
"
